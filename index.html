<!DOCTYPE html>
<html lang="ru" class="scroll-smooth" style="background:#202124">
<head>
  <!-- Метаданные и предзагрузка ресурсов вашего основного сайта -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width"/>
  <meta name="theme-color" content="#FFFFFF"/>
  <title>ChatGPT на русском: вход в ChatGPT онлайн MashaGPT</title>
  <meta name="description" content="ChatGPT на русском: вход или регистрация. Сервис по работе с ChatGPT — №1 для пользователей из России. ChatGPT-4o-mini/4o онлайн на русском. Работает без VPN. Напишет вам тексты, эссе и код для программистов. Отвечает на вопросы, создаёт идеи и изображения. Бесплатные генерации каждый день."/>
  <!-- Остальные метатеги и предзагрузка ресурсов -->

  <!-- Подключение стилей вашего основного сайта -->
  <link rel="stylesheet" href="/_next/static/css/90c42edd01ebbd91.css" data-n-g=""/>
  <link rel="stylesheet" href="/_next/static/css/d9322df4fe06496f.css" data-n-p=""/>
  
  <!-- Подключение стилей чата ORKGPT -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
  <style>
    /* Стили чата ORKGPT */
    /* (Скопируйте сюда все стили из первого HTML-кода) */
    /* Пример: */
    .container {
      display: flex;
      height: 100vh;
      width: 100vw;
    }
    /* Добавьте остальные стили... */
    
    /* Убедитесь, что стили не конфликтуют с основным сайтом */
  </style>
</head>
<body class="scrollbar bg-surface-primary-default scrollbar-thumb-st-secondary scrollbar-track scrollbar-track-rounded-lg scrollbar-thumb-rounded-lg scrollbar-w-[6px]">
  <div id="__next">
    <!-- Структура вашего основного сайта -->
    <!-- ... -->

    <!-- Место для интеграции чата -->
    <div class="container">
      <div class="sidebar">
        <button class="new-chat-button" id="newChatButton">New Chat</button>
        <div id="chatHistory"></div>
      </div>
      <div class="main-content">
        <div class="header">
          <h1>ORKGPT</h1>
          <button id="debugButton">Debug</button>
        </div>
        <div class="chat-area" id="chat-area">
          <!-- Chat messages will be inserted here -->
        </div>
        <textarea id="userInput" placeholder="Type your message here..."></textarea>
        <button id="sendButton">Send</button>
        <!-- File upload button -->
        <input type="file" id="fileInput" style="display: none;" multiple />
        <button id="uploadButton">Upload Files</button>
        <select id="modelSelect">
          <option value="">Loading models...</option>
        </select>
        <div class="footer">
          ORKGPT. Free Research Preview. Our goal is to make AI systems more natural and safe to interact with. Your feedback will help us improve.
        </div>
        <div class="created-by">Created by @laznin ⚡</div>
      </div>
    </div>

    <!-- Остальная часть вашего основного сайта -->
    <!-- ... -->

    <!-- Всплывающие окна и оверлей -->
    <div id="overlay" class="overlay"></div>
    <div id="popup" class="popup">
      <button class="close-popup" onclick="closePopup()">×</button>
      <div id="popupContent" class="popup-content"></div>
    </div>
  </div>

  <!-- Подключение скриптов вашего основного сайта -->
  <script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" defer></script>
  <script src="./main.js" async defer data-nscript="beforeInteractive"></script>
  <script src="/_next/static/chunks/webpack-b44dedb1f244bb41.js" defer></script>
  <script src="/_next/static/chunks/framework-b0ec748c7a4c483a.js" defer></script>
  <script src="/_next/static/chunks/main-29a491a23e8fc869.js" defer></script>
  <script src="/_next/static/chunks/pages/_app-0b8f0acbc034d1fa.js" defer></script>
  <script src="/_next/static/chunks/0f4ba5df-829aa9708f446b36.js" defer></script>
  <script src="/_next/static/chunks/175675d1-a1a6b6f4df43b8f4.js" defer></script>
  <script src="/_next/static/chunks/31d4e3d1-51085b68e92f5fd1.js" defer></script>
  <script src="/_next/static/chunks/6132-32a6ce0320c3dd32.js" defer></script>
  <script src="/_next/static/chunks/7311-6da058c6ffeadead.js" defer></script>
  <script src="/_next/static/chunks/6753-1b841bad857904f7.js" defer></script>
  <script src="/_next/static/chunks/1819-12e58a6a2643ddd3.js" defer></script>
  <script src="/_next/static/chunks/8732-f22ddc8a7ce35370.js" defer></script>
  <script src="/_next/static/chunks/6222-4bfcb633d558ff3d.js" defer></script>
  <script src="/_next/static/chunks/2178-ee0c9fa8c6342fd5.js" defer></script>
  <script src="/_next/static/chunks/3787-df99eeb3338906ca.js" defer></script>
  <script src="/_next/static/chunks/pages/rustore/chat-a05e7ac1af67de5a.js" defer></script>
  <script src="/_next/static/z6UmvOchI6o3SAv9J-per/_buildManifest.js" defer></script>
  <script src="/_next/static/z6UmvOchI6o3SAv9J-per/_ssgManifest.js" defer></script>

  <!-- Подключение скриптов чата ORKGPT -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>
    // Инициализация highlight.js
    hljs.highlightAll();
  </script>
  <script>
    // Ваши скрипты для чата ORKGPT
    // (Скопируйте сюда весь JavaScript из первого HTML-кода)
    // Пример:
    const systemPrompt = `You are ORKGPT, an AI assistant. Respond in a clear, professional, and concise manner. Provide code snippets when necessary with proper syntax highlighting. Use fractions instead of decimal numbers where applicable. Do not alter code blocks.`;
    let selectedModel = '';
    let currentChatId = null;
    let debugMode = false;

    function generateUniqueId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function addMessage(role, content) {
      const chatArea = document.getElementById('chat-area');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role}`;

      const prefix = role === 'user' ? 'User: ' : (role === 'assistant' ? 'ORKGPT: ' : 'System: ');

      const messageContent = document.createElement('div');
      
      if (role === 'assistant') {
        // Преобразуем десятичные числа в дроби для сообщений ассистента
        content = convertDecimalsToFractions(content);
      }

      messageContent.innerHTML = prefix + content;

      messageContent.querySelectorAll('pre code').forEach((block) => {
        hljs.highlightElement(block);
      });

      messageDiv.appendChild(messageContent);
      chatArea.appendChild(messageDiv);
      chatArea.scrollTop = chatArea.scrollHeight;

      if (currentChatId) {
        let chats = JSON.parse(localStorage.getItem('aiChats')) || {};
        if (!chats[currentChatId]) {
          chats[currentChatId] = { messages: [], name: `Chat ${currentChatId.substr(0, 6)}...` };
        }
        const messageExists = chats[currentChatId].messages.some(
          m => m.role === role && m.content === content
        );
        if (!messageExists) {
          chats[currentChatId].messages.push({role, content});
          localStorage.setItem('aiChats', JSON.stringify(chats));
        }
        updateChatHistory();
      }
    }

    function addLoadingSpinner() {
      const chatArea = document.getElementById('chat-area');
      const spinnerDiv = document.createElement('div');
      spinnerDiv.className = 'message system';
      spinnerDiv.innerHTML = 'ORKGPT: <div class="loading-spinner"></div>';
      chatArea.appendChild(spinnerDiv);
      chatArea.scrollTop = chatArea.scrollHeight;
      return spinnerDiv;
    }

    function startNewChat() {
      currentChatId = generateUniqueId();
      document.getElementById('chat-area').innerHTML = '';
      addMessage('system', 'Hello! How can I assist you today?');
      updateChatHistory();
    }

    function updateChatHistory() {
      const chatHistory = document.getElementById('chatHistory');
      chatHistory.innerHTML = '';
      const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
      Object.keys(chats).forEach(chatId => {
        const chatDiv = document.createElement('div');
        chatDiv.className = 'chat-history-item';
        if (chatId === currentChatId) {
          chatDiv.classList.add('selected');
        }
        
        const chatName = document.createElement('span');
        chatName.textContent = chats[chatId].name || `Chat ${chatId.substr(0, 6)}...`;
        chatDiv.appendChild(chatName);
        
        const buttonsDiv = document.createElement('div');
        buttonsDiv.className = 'chat-history-buttons';
        
        const renameButton = document.createElement('button');
        renameButton.textContent = 'Rename';
        renameButton.className = 'chat-history-button';
        renameButton.onclick = (e) => {
          e.stopPropagation();
          renameChat(chatId);
        };
        
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.className = 'chat-history-button';
        deleteButton.onclick = (e) => {
          e.stopPropagation();
          deleteChat(chatId);
        };
        
        if (debugMode) {
          const eyeballButton = document.createElement('button');
          eyeballButton.innerHTML = '👁️';
          eyeballButton.className = 'eyeball-button';
          eyeballButton.onclick = (e) => {
            e.stopPropagation();
            showChatData(chatId);
          };
          buttonsDiv.appendChild(eyeballButton);
        }
        
        buttonsDiv.appendChild(renameButton);
        buttonsDiv.appendChild(deleteButton);
        
        chatDiv.appendChild(buttonsDiv);
        chatHistory.appendChild(chatDiv);
        
        chatDiv.onclick = () => loadChat(chatId);
      });
    }

    function loadChat(chatId) {
      if (currentChatId === chatId) return;
      currentChatId = chatId;
      const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
      const chatMessages = chats[chatId].messages || [];
      const chatArea = document.getElementById('chat-area');
      chatArea.innerHTML = '';
      chatMessages.forEach(message => addMessage(message.role, message.content));
      updateChatHistory();
    }

    function renameChat(chatId) {
      const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
      const newName = prompt('Enter new name for the chat:', chats[chatId].name);
      if (newName !== null) {
        chats[chatId].name = newName;
        localStorage.setItem('aiChats', JSON.stringify(chats));
        updateChatHistory();
      }
    }

    function deleteChat(chatId) {
      if (confirm('Are you sure you want to delete this chat?')) {
        const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
        delete chats[chatId];
        localStorage.setItem('aiChats', JSON.stringify(chats));
        if (currentChatId === chatId) {
          startNewChat();
        } else {
          updateChatHistory();
        }
      }
    }

    function showChatData(chatId) {
      const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
      const chatData = chats[chatId];
      const totalCharCount = chatData.messages.reduce((count, message) => count + message.content.length, 0);
      
      let popupContent = `Chat ID: ${chatId}\n`;
      popupContent += `Chat Name: ${chatData.name}\n`;
      popupContent += `Total Character Count: ${totalCharCount}\n\n`;
      popupContent += `Messages:\n`;
      chatData.messages.forEach((message, index) => {
        popupContent += `\n[${index + 1}] ${message.role}: ${message.content}\n`;
      });
    
      document.getElementById('popupContent').textContent = popupContent;
      document.getElementById('popup').style.display = 'block';
      document.getElementById('overlay').style.display = 'block';
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    fetch('https://api.llmplayground.net/v1/models')
      .then(response => response.json())
      .then(data => {
        const select = document.getElementById('modelSelect');
        select.innerHTML = '';
        data.data.forEach(model => {
          const option = document.createElement('option');
          option.value = model.id;
          option.textContent = model.id;
          select.appendChild(option);
        });
        select.value = 'gpt-4';
        selectedModel = 'gpt-4';
      })
      .catch(error => console.error('Error fetching AI models:', error));

    document.getElementById('modelSelect').addEventListener('change', (event) => {
      selectedModel = event.target.value;
    });

    function sendMessage() {
      const userInput = document.getElementById('userInput');
      const message = userInput.value.trim();
      if (message) {
        addMessage('user', message);
        sendMessageToAI(message);
        userInput.value = '';
      }
    }

    document.getElementById('sendButton').addEventListener('click', sendMessage);
    document.getElementById('userInput').addEventListener('keydown', (event) => {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    });

    function sendMessageToAI(message) {
      const loadingSpinner = addLoadingSpinner();
      fetch('https://api.llmplayground.net/v1/chat/completions', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          model: selectedModel,
          messages: [
            { role: 'system', content: systemPrompt },
            ...getCurrentChatMessages(),
            { role: 'user', content: message }
          ],
          max_tokens: 2048,
          temperature: 0.7,
        })
      })
      .then(response => response.json())
      .then(data => {
        loadingSpinner.remove();
        if (data.choices && data.choices.length > 0) {
          addMessage('assistant', data.choices[0].message.content);
        } else {
          addMessage('system', 'Sorry, I couldn\'t generate a response.');
        }
      })
      .catch(error => {
        loadingSpinner.remove();
        console.error('Error sending message to AI:', error);
        addMessage('system', 'Sorry, there was an error communicating with the AI.');
      });
    }

    function getCurrentChatMessages() {
      const chats = JSON.parse(localStorage.getItem('aiChats')) || {};
      return currentChatId && chats[currentChatId] ? chats[currentChatId].messages : [];
    }

    document.getElementById('newChatButton').addEventListener('click', startNewChat);

    document.getElementById('debugButton').addEventListener('click', () => {
      debugMode = !debugMode;
      updateChatHistory();
    });

    updateChatHistory();
    if (!currentChatId) {
      startNewChat();
    } else {
      loadChat(currentChatId);
    }

    document.getElementById('overlay').addEventListener('click', closePopup);

    document.getElementById('uploadButton').addEventListener('click', () => {
      document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', handleFileUpload);

    function handleFileUpload(event) {
      const files = event.target.files;
      if (files.length > 0) {
        Array.from(files).forEach(file => {
          const reader = new FileReader();
          reader.onload = function(e) {
            const content = e.target.result;
            addMessage('user', `Uploaded file: ${file.name}\n\nContent:\n${content}`);
          };
          reader.readAsText(file);
        });
      }
    }

    /**
     * Функция для преобразования десятичных чисел в дроби
     * @param {string} text - Текст сообщения
     * @returns {string} - Обновленный текст с дробями
     */
    function convertDecimalsToFractions(text) {
      // Разделяем текст на части, исключая кодовые блоки
      const parts = text.split(/(```[\s\S]*?```)/g);
      for (let i = 0; i < parts.length; i++) {
        // Пропускаем кодовые блоки
        if (parts[i].startsWith('```')) continue;
        // Регулярное выражение для поиска десятичных чисел (включая отрицательные)
        const decimalRegex = /(-?\d+\.\d+)/g;
        parts[i] = parts[i].replace(decimalRegex, (match) => {
          const decimal = parseFloat(match);
          // Если число целое (например, 25.0), возвращаем целое число
          if (Number.isInteger(decimal)) {
            return decimal.toString();
          }
          const fraction = decimalToFraction(decimal);
          return fraction ? fraction : match;
        });
      }
      return parts.join('');
    }

    /**
     * Преобразование десятичного числа в дробь
     * @param {number} decimal - Десятичное число
     * @returns {string|null} - Дробь в формате 'числитель/знаменатель' или null, если невозможно
     */
    function decimalToFraction(decimal) {
      const tolerance = 1.0E-6;
      let h1 = 1, h2 = 0;
      let k1 = 0, k2 = 1;
      let b = Math.abs(decimal);
      let sign = decimal < 0 ? '-' : '';

      while (Math.abs(h1 / k1 - b) > tolerance && k1 < 1000) {
        const a = Math.floor(b);
        const aux = h1;
        h1 = a * h1 + h2;
        h2 = aux;
        const auxk = k1;
        k1 = a * k1 + k2;
        k2 = auxk;
        b = 1 / (b - a);
        if (isNaN(b) || !isFinite(b)) break;
      }

      // Если знаменатель превышает 1000, не преобразуем
      if (k1 > 1000) return null;

      return sign + `${h1}/${k1}`;
    }
  </script>
</body>
</html>
